# 快速安装指南

## 新用户或更新部署

本项目新增了公司搜索、性能优化和批量更新脚本功能。

### 安装步骤

```bash
# 1. 克隆/拉取最新代码
git pull

# 2. 安装依赖（包含新增的 tsx）
pnpm install

# 3. 应用数据库变更（重要！）
pnpm prisma db push

# 4. 重新生成 Prisma Client
pnpm prisma generate

# 5. 启动项目
pnpm dev
```

### 可选：批量导入公司数据

如果你的数据库中已有游戏但缺少公司信息：

```bash
# 测试模式（推荐）
npx tsx scripts/update-companies.ts --limit 10 --dry-run

# 正式更新
npx tsx scripts/update-companies.ts
```

---

## 已有项目更新

如果项目正在运行，只需：

```bash
# 1. 安装新依赖
pnpm install

# 2. 应用数据库索引（必须！）
pnpm prisma db push

# 3. 重新生成类型
pnpm prisma generate

# 4. 重启服务
# Ctrl+C 停止，然后 pnpm dev
```

---

## 关键说明

### ⚠️ 必须运行数据库迁移

本次更新添加了：
- 新表：`patch_company`, `patch_company_relation`
- 新索引：提升搜索性能

**不运行 `pnpm prisma db push` 会导致功能异常！**

### ✅ 只需运行一次 `pnpm install`

所有新依赖（如 `tsx`）已在 `package.json` 中定义，运行 `pnpm install` 即可自动安装，**无需手动安装额外依赖**。

### 📦 依赖变更

- 新增：`tsx@4.21.0` (开发依赖，用于批量更新脚本)

---

## 验证安装

### 1. 检查依赖
```bash
pnpm list tsx
# 应显示: tsx@4.21.0
```

### 2. 检查数据库
```bash
pnpm prisma studio
# 查看是否存在 patch_company 表
```

### 3. 测试搜索
访问 `http://localhost:3000/search` 并尝试搜索，应该看到公司建议（金色徽章）。

---

## 故障排除

### 问题：搜索功能异常
```bash
# 解决方案：重新生成 Prisma Client
pnpm prisma generate
```

### 问题：tsx 命令找不到
```bash
# 解决方案：重新安装依赖
pnpm install
```

### 问题：数据库错误
```bash
# 解决方案：检查连接并重新推送 schema
pnpm prisma db push --force-reset  # 谨慎使用！会清空数据
```

---

**完成安装后，查看 [新功能使用文档](./新功能使用文档.md) 了解详细功能说明。**
